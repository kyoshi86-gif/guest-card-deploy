import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              */import{c as B,l as L,s as d}from"./base-B22LZU_k.js";import"https://esm.sh/@supabase/supabase-js";B();document.getElementById("logout").onclick=L;const j=document.getElementById("gcForm"),c=document.getElementById("row_id"),v=document.getElementById("mediaLainnyaRadio"),y=document.getElementById("eventLainnyaRadio"),l=document.getElementById("media_other"),i=document.getElementById("event_other"),_=document.getElementById("btnSave"),f=document.getElementById("btnUpdate"),p=document.getElementById("btnDelete"),q=document.getElementById("btnCancel");document.getElementById("btnClose");const w=document.getElementById("btnReport"),b=document.getElementById("listBody");function s(t){return document.getElementById(t).value.trim()}function a(t){const e=document.querySelector(`input[name="${t}"]:checked`);return e?e.value.trim():null}function r(t,e){if(!e)return;const n=document.querySelector(`input[name="${t}"][value="${e}"]`);n&&(n.checked=!0)}function k(){document.querySelectorAll('input[name="media_source"]').forEach(t=>{t.addEventListener("change",()=>{const e=v&&v.checked;l.disabled=!e,e||(l.value="")})}),document.querySelectorAll('input[name="event_type"]').forEach(t=>{t.addEventListener("change",()=>{const e=y&&y.checked;i.disabled=!e,e||(i.value="")})})}function u(){j.reset(),c.value="",l.disabled=!0,i.disabled=!0,_.disabled=!1,f.disabled=!0,p.disabled=!0}function E(){return{tgl:s("tgl"),jam:s("jam"),no_meja:s("no_meja"),nama_tamu:s("nama_tamu"),asal:a("asal"),media_source:a("media_source"),media_other:l.value.trim()||null,event_type:a("event_type"),event_other:i.value.trim()||null,age_range:a("age_range"),food_quality:a("food_quality")?parseInt(a("food_quality")):null,beverage_quality:a("beverage_quality")?parseInt(a("beverage_quality")):null,serving_speed:a("serving_speed")?parseInt(a("serving_speed")):null,service_rating:a("service_rating")?parseInt(a("service_rating")):null,cleanliness:a("cleanliness")?parseInt(a("cleanliness")):null,ambience:a("ambience")?parseInt(a("ambience")):null,price_rating:a("price_rating")?parseInt(a("price_rating")):null,comments:document.getElementById("comments").value.trim()||null}}function h(t){return!t.tgl||!t.jam||!t.no_meja||!t.nama_tamu?(alert("Mohon isi Tanggal, Jam, No Meja, dan Nama."),!1):!0}let g=[];async function m(){const{data:t,error:e}=await d.from("guest_comments").select("id,tgl,jam,no_meja,nama_tamu").order("tgl",{ascending:!1}).order("jam",{ascending:!1}).limit(500);if(e){console.error("Load error:",e.message);return}g=t||[],I(g)}function I(t){b.innerHTML="",t.forEach((e,n)=>{const o=document.createElement("tr");o.innerHTML=`
      <td>${n+1}</td>
      <td>${e.tgl??""}</td>
      <td>${e.jam??""}</td>
      <td>${e.no_meja??""}</td>
      <td>${e.nama_tamu??""}</td>`,o.addEventListener("click",()=>D(e.id)),b.appendChild(o)})}function C(){const t=document.getElementById("searchBox");t&&t.addEventListener("input",()=>{const e=t.value.toLowerCase(),n=g.filter(o=>(o.nama_tamu??"").toLowerCase().includes(e)||(o.no_meja??"").toLowerCase().includes(e)||(o.tgl??"").toLowerCase().includes(e));I(n)})}async function D(t){const{data:e,error:n}=await d.from("guest_comments").select("*").eq("id",t).single();if(n){alert("Gagal mengambil data: "+n.message);return}c.value=e.id,document.getElementById("tgl").value=e.tgl??"",document.getElementById("jam").value=(e.jam??"").toString().substring(0,5),document.getElementById("no_meja").value=e.no_meja??"",document.getElementById("nama_tamu").value=e.nama_tamu??"",r("asal",e.asal),r("media_source",e.media_source),r("event_type",e.event_type),r("age_range",e.age_range),e.media_source==="Lainnya"&&(l.disabled=!1,l.value=e.media_other??""),e.event_type==="Lainnya"&&(i.disabled=!1,i.value=e.event_other??""),r("food_quality",e.food_quality),r("beverage_quality",e.beverage_quality),r("serving_speed",e.serving_speed),r("service_rating",e.service_rating),r("cleanliness",e.cleanliness),r("ambience",e.ambience),r("price_rating",e.price_rating),document.getElementById("comments").value=e.comments??"",_.disabled=!0,f.disabled=!1,p.disabled=!1}async function R(){let t=E();if(!h(t))return;delete t.id,Object.keys(t).forEach(n=>{(t[n]===null||t[n]===void 0||t[n]==="")&&delete t[n]}),console.group("DEBUG SAVE"),console.log("Payload final:",t),console.groupEnd();const{error:e}=await d.from("guest_comments").insert([t]);if(e){console.error("Insert error:",e),alert("Gagal simpan: "+e.message);return}alert("Data tersimpan."),u(),m()}async function S(){const t=c.value;if(!t){alert("Pilih data pada tabel (kanan) untuk di-update.");return}let e=E();if(!h(e))return;Object.keys(e).forEach(o=>{(e[o]===null||e[o]===void 0||e[o]==="")&&delete e[o]});const{error:n}=await d.from("guest_comments").update(e).eq("id",t);if(n){console.error("Update error:",n),alert("Gagal update: "+n.message);return}alert("Data berhasil diupdate."),u(),m()}async function $(){const t=c.value;if(!t){alert("Pilih data pada tabel (kanan) untuk dihapus.");return}if(!confirm("Yakin hapus data ini?"))return;const{error:e}=await d.from("guest_comments").delete().eq("id",t);if(e){console.error("Delete error:",e),alert("Gagal hapus: "+e.message);return}alert("Data dihapus."),u(),m()}function M(){u()}function O(){window.open("report.html")}document.addEventListener("DOMContentLoaded",()=>{k(),m(),C(),_.addEventListener("click",R),f.addEventListener("click",S),p.addEventListener("click",$),q.addEventListener("click",M),w.addEventListener("click",O)});
