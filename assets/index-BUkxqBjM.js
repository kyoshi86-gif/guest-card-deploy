import{createClient as j}from"https://esm.sh/@supabase/supabase-js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const p of o.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&l(p)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();const q="https://drdflrzsvfakdnhqniaa.supabase.co",O="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRyZGZscnpzdmZha2RuaHFuaWFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1ODY5MDAsImV4cCI6MjA3MTE2MjkwMH0.I88GG5xoPsO0h5oXBxPt58rfuxIqNp7zQS7jvexXss8",s=(window.__supabase||(window.__supabase=j(q,O)),window.__supabase),k=3600*1e3;async function C(){const{data:t}=await s.auth.getSession();if(!t.session)return window.location.href="/login.html",Promise.reject("Not logged in");const e=localStorage.getItem("login_time");e?Date.now()-parseInt(e,10)>k&&w(!0):localStorage.setItem("login_time",Date.now())}async function w(t=!1){await s.auth.signOut(),localStorage.removeItem("supabase.auth.token"),localStorage.removeItem("login_time"),t&&alert("Anda telah logout"),window.location.href="login.html"}s.auth.onAuthStateChange((t,e)=>{e||(localStorage.removeItem("login_time"),window.location.href="login.html")});C();document.getElementById("logout").onclick=w;const R=document.getElementById("gcForm"),m=document.getElementById("row_id"),I=document.getElementById("mediaLainnyaRadio"),b=document.getElementById("eventLainnyaRadio"),d=document.getElementById("media_other"),c=document.getElementById("event_other"),y=document.getElementById("btnSave"),v=document.getElementById("btnUpdate"),h=document.getElementById("btnDelete"),M=document.getElementById("btnCancel");document.getElementById("btnClose");const D=document.getElementById("btnReport"),E=document.getElementById("listBody");function u(t){return document.getElementById(t).value.trim()}function i(t){const e=document.querySelector(`input[name="${t}"]:checked`);return e?e.value:null}function r(t,e){if(!e)return;const n=document.querySelector(`input[name="${t}"][value="${e}"]`);n&&(n.checked=!0)}function P(){document.querySelectorAll('input[name="media_source"]').forEach(t=>{t.addEventListener("change",()=>{const e=I&&I.checked;d.disabled=!e,e||(d.value="")})}),document.querySelectorAll('input[name="event_type"]').forEach(t=>{t.addEventListener("change",()=>{const e=b&&b.checked;c.disabled=!e,e||(c.value="")})})}function g(){R.reset(),m.value="",d.disabled=!0,c.disabled=!0,y.disabled=!1,v.disabled=!0,h.disabled=!0}function L(){return{tgl:u("tgl"),jam:u("jam"),no_meja:u("no_meja"),nama_tamu:u("nama_tamu"),asal:i("asal"),media_source:i("media_source"),media_other:d.value.trim()||null,event_type:i("event_type"),event_other:c.value.trim()||null,age_range:i("age_range"),food_quality:parseInt(i("food_quality"))||null,beverage_quality:parseInt(i("beverage_quality"))||null,serving_speed:parseInt(i("serving_speed"))||null,service_rating:parseInt(i("service_rating"))||null,cleanliness:parseInt(i("cleanliness"))||null,ambience:parseInt(i("ambience"))||null,price_rating:parseInt(i("price_rating"))||null,comments:document.getElementById("comments").value.trim()||null}}function B(t){return!t.tgl||!t.jam||!t.no_meja||!t.nama_tamu?(alert("Mohon isi Tanggal, Jam, No Meja, dan Nama."),!1):!0}let _=[];async function f(){const{data:t,error:e}=await s.from("guest_comments").select("id,tgl,jam,no_meja,nama_tamu").order("tgl",{ascending:!1}).order("jam",{ascending:!1}).limit(500);if(e){console.error("Load error:",e.message);return}_=t||[],S(_)}function S(t){E.innerHTML="",t.forEach((e,n)=>{const l=document.createElement("tr");l.innerHTML=`
      <td>${n+1}</td>
      <td>${e.tgl??""}</td>
      <td>${e.jam??""}</td>
      <td>${e.no_meja??""}</td>
      <td>${e.nama_tamu??""}</td>`,l.addEventListener("click",()=>A(e.id)),E.appendChild(l)})}function N(){const t=document.getElementById("searchBox");t&&t.addEventListener("input",()=>{const e=t.value.toLowerCase(),n=_.filter(l=>(l.nama_tamu??"").toLowerCase().includes(e)||(l.no_meja??"").toLowerCase().includes(e)||(l.tgl??"").toLowerCase().includes(e));S(n)})}async function A(t){const{data:e,error:n}=await s.from("guest_comments").select("*").eq("id",t).single();if(n){alert("Gagal mengambil data: "+n.message);return}m.value=e.id,document.getElementById("tgl").value=e.tgl??"",document.getElementById("jam").value=(e.jam??"").toString().substring(0,5),document.getElementById("no_meja").value=e.no_meja??"",document.getElementById("nama_tamu").value=e.nama_tamu??"",r("asal",e.asal),r("media_source",e.media_source),r("event_type",e.event_type),r("age_range",e.age_range),e.media_source==="Lainnya"&&(d.disabled=!1,d.value=e.media_other??""),e.event_type==="Lainnya"&&(c.disabled=!1,c.value=e.event_other??""),r("food_quality",e.food_quality),r("beverage_quality",e.beverage_quality),r("serving_speed",e.serving_speed),r("service_rating",e.service_rating),r("cleanliness",e.cleanliness),r("ambience",e.ambience),r("price_rating",e.price_rating),document.getElementById("comments").value=e.comments??"",y.disabled=!0,v.disabled=!1,h.disabled=!1}async function G(){const t=L();if(!B(t))return;delete t.id;const{error:e}=await s.from("guest_comments").insert([t]);if(e){alert("Gagal simpan: "+e.message);return}alert("Data tersimpan."),g(),f()}async function J(){const t=m.value;if(!t){alert("Pilih data pada tabel (kanan) untuk di-update.");return}const e=L();if(!B(e))return;const{error:n}=await s.from("guest_comments").update(e).eq("id",t);if(n){alert("Gagal update: "+n.message);return}alert("Data berhasil diupdate."),g(),f()}async function T(){const t=m.value;if(!t){alert("Pilih data pada tabel (kanan) untuk dihapus.");return}if(!confirm("Yakin hapus data ini?"))return;const{error:e}=await s.from("guest_comments").delete().eq("id",t);if(e){alert("Gagal hapus: "+e.message);return}alert("Data dihapus."),g(),f()}function $(){g()}function F(){window.open("report.html")}document.addEventListener("DOMContentLoaded",()=>{P(),f(),N(),y.addEventListener("click",G),v.addEventListener("click",J),h.addEventListener("click",T),M.addEventListener("click",$),D.addEventListener("click",F)});
