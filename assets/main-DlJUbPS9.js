import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              */import{c as B,l as L,s as d}from"./base-B22LZU_k.js";import"https://esm.sh/@supabase/supabase-js";B();document.getElementById("logout").onclick=L;const j=document.getElementById("gcForm"),u=document.getElementById("row_id"),v=document.getElementById("mediaLainnyaRadio"),y=document.getElementById("eventLainnyaRadio"),i=document.getElementById("media_other"),l=document.getElementById("event_other"),_=document.getElementById("btnSave"),f=document.getElementById("btnUpdate"),p=document.getElementById("btnDelete"),q=document.getElementById("btnCancel");document.getElementById("btnClose");const k=document.getElementById("btnReport"),b=document.getElementById("listBody");function s(t){return document.getElementById(t).value.trim()}function n(t){const e=document.querySelector(`input[name="${t}"]:checked`);return e?e.value.trim():null}function o(t,e){if(!e)return;const a=document.querySelector(`input[name="${t}"][value="${e}"]`);a&&(a.checked=!0)}function w(){document.querySelectorAll('input[name="media_source"]').forEach(t=>{t.addEventListener("change",()=>{const e=v&&v.checked;i.disabled=!e,e||(i.value="")})}),document.querySelectorAll('input[name="event_type"]').forEach(t=>{t.addEventListener("change",()=>{const e=y&&y.checked;l.disabled=!e,e||(l.value="")})})}function c(){j.reset(),u.value="",i.disabled=!0,l.disabled=!0,_.disabled=!1,f.disabled=!0,p.disabled=!0}function E(){return{tgl:s("tgl"),jam:s("jam"),no_meja:s("no_meja"),nama_tamu:s("nama_tamu"),asal:n("asal"),kunjungan_pertama:n("kunjungan_pertama"),media_source:n("media_source"),media_other:i.value.trim()||null,event_type:n("event_type"),event_other:l.value.trim()||null,age_range:n("age_range"),food_quality:n("food_quality")?parseInt(n("food_quality")):null,beverage_quality:n("beverage_quality")?parseInt(n("beverage_quality")):null,serving_speed:n("serving_speed")?parseInt(n("serving_speed")):null,service_rating:n("service_rating")?parseInt(n("service_rating")):null,cleanliness:n("cleanliness")?parseInt(n("cleanliness")):null,ambience:n("ambience")?parseInt(n("ambience")):null,price_rating:n("price_rating")?parseInt(n("price_rating")):null,comments:document.getElementById("comments").value.trim()||null}}function h(t){return!t.tgl||!t.jam||!t.no_meja||!t.nama_tamu?(alert("Mohon isi Tanggal, Jam, No Meja, dan Nama."),!1):!0}let g=[];async function m(){const{data:t,error:e}=await d.from("guest_comments").select("id,tgl,jam,no_meja,nama_tamu").order("tgl",{ascending:!1}).order("jam",{ascending:!1}).limit(500);if(e){console.error("Load error:",e.message);return}g=t||[],I(g)}function I(t){b.innerHTML="",t.forEach((e,a)=>{const r=document.createElement("tr");r.innerHTML=`
      <td>${a+1}</td>
      <td>${e.tgl??""}</td>
      <td>${e.jam??""}</td>
      <td>${e.no_meja??""}</td>
      <td>${e.nama_tamu??""}</td>`,r.addEventListener("click",()=>R(e.id)),b.appendChild(r)})}function C(){const t=document.getElementById("searchBox");t&&t.addEventListener("input",()=>{const e=t.value.toLowerCase(),a=g.filter(r=>(r.nama_tamu??"").toLowerCase().includes(e)||(r.no_meja??"").toLowerCase().includes(e)||(r.tgl??"").toLowerCase().includes(e));I(a)})}async function R(t){const{data:e,error:a}=await d.from("guest_comments").select("*").eq("id",t).single();if(a){alert("Gagal mengambil data: "+a.message);return}u.value=e.id,document.getElementById("tgl").value=e.tgl??"",document.getElementById("jam").value=(e.jam??"").toString().substring(0,5),document.getElementById("no_meja").value=e.no_meja??"",document.getElementById("nama_tamu").value=e.nama_tamu??"",o("asal",e.asal),o("kunjungan_pertama",e.kunjungan_pertama),o("media_source",e.media_source),o("event_type",e.event_type),o("age_range",e.age_range),e.media_source==="Lainnya"&&(i.disabled=!1,i.value=e.media_other??""),e.event_type==="Lainnya"&&(l.disabled=!1,l.value=e.event_other??""),o("food_quality",e.food_quality),o("beverage_quality",e.beverage_quality),o("serving_speed",e.serving_speed),o("service_rating",e.service_rating),o("cleanliness",e.cleanliness),o("ambience",e.ambience),o("price_rating",e.price_rating),document.getElementById("comments").value=e.comments??"",_.disabled=!0,f.disabled=!1,p.disabled=!1}async function D(){let t=E();if(!h(t))return;delete t.id,Object.keys(t).forEach(a=>{(t[a]===null||t[a]===void 0||t[a]==="")&&delete t[a]});const{error:e}=await d.from("guest_comments").insert([t]);if(e){console.error("Insert error:",e),alert("Gagal simpan: "+e.message);return}alert("Data tersimpan."),c(),m()}async function S(){const t=u.value;if(!t){alert("Pilih data pada tabel (kanan) untuk di-update.");return}let e=E();if(!h(e))return;Object.keys(e).forEach(r=>{(e[r]===null||e[r]===void 0||e[r]==="")&&delete e[r]});const{error:a}=await d.from("guest_comments").update(e).eq("id",t);if(a){console.error("Update error:",a),alert("Gagal update: "+a.message);return}alert("Data berhasil diupdate."),c(),m()}async function $(){const t=u.value;if(!t){alert("Pilih data pada tabel (kanan) untuk dihapus.");return}if(!confirm("Yakin hapus data ini?"))return;const{error:e}=await d.from("guest_comments").delete().eq("id",t);if(e){console.error("Delete error:",e),alert("Gagal hapus: "+e.message);return}alert("Data dihapus."),c(),m()}function M(){c()}function O(){window.open("report.html")}document.addEventListener("DOMContentLoaded",()=>{w(),m(),C(),_.addEventListener("click",D),f.addEventListener("click",S),p.addEventListener("click",$),q.addEventListener("click",M),k.addEventListener("click",O)});
